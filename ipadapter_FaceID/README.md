

## <a name="Introduction"></a>ğŸ“– Introduction

We provide Kolors-IP-Adapter-FaceID-Plus module weights and inference code based on [Kolors-Basemodel](https://huggingface.co/Kwai-Kolors/Kolors). Examples of Kolors-IP-Adapter-FaceID-Plus results are as follows:


<table>
  <tr>
    <td colspan="3" align="center">Example Results</td>
  </tr>
  
   <tr>
    <td align="center">Reference Image </td>
    <td align="center">Prompt </td>
    <td align="center">Result Image </td>
  </tr>

  <tr>
    <td align="center"><img src="./assets/image1.png" width=400px/></td>
    <td align="center"><font style="font-size:12px"> ç©¿ç€æ™šç¤¼æœï¼Œåœ¨æ˜Ÿå…‰ä¸‹çš„æ™šå®´åœºæ™¯ä¸­ï¼Œçƒ›å…‰é—ªé—ªï¼Œæ•´ä¸ªåœºæ™¯æ´‹æº¢ç€æµªæ¼«è€Œå¥¢åçš„æ°›å›´ </p> Wearing an evening dress, in a starry night banquet scene, candlelight flickering, the whole scene exudes a romantic and luxurious atmosphere. </font> </td> 
    <td align="center"><img src="./assets/image1_res.png" width=400px/></td>
  </tr>

  <tr>
    <td align="center"><img src="./assets/image2.png" width=400px/></td>
    <td align="center"><font style="font-size:12px"> è¥¿éƒ¨ç‰›ä»”ï¼Œç‰›ä»”å¸½ï¼Œè’é‡å¤§é•–å®¢ï¼ŒèƒŒæ™¯æ˜¯è¥¿éƒ¨å°é•‡ï¼Œä»™äººæŒï¼Œ,æ—¥è½ä½™æ™–, æš–è‰²è°ƒ, ä½¿ç”¨XT4èƒ¶ç‰‡æ‹æ‘„, å™ªç‚¹, æ™•å½±, æŸ¯è¾¾èƒ¶å·ï¼Œå¤å¤ </p> Western cowboy, cowboy hat, Red Dead Redemption, background is a western town, cactus, sunset glow, warm tones, shot with XT4 film, grain, vignette, Kodak film, retro. </font> </td> 
    <td align="center"><img src="./assets/image2_res.png" width=400px/></td>
  </tr>
</table>

- Our Kolors-IP-Adapter-FaceID-Plus module is trained on a large-scale and high-quality face dataset. We use the face ID embeddings generated by [insightface](https://github.com/deepinsight/insightface) and the CLIP features of face area to keep the face ID and structure information.

## <a name="Evaluation"></a>ğŸ“Š Evaluation
For evaluation, we constructed a test set consisting of over 200 reference images and text prompts. We invited several image experts to provide fair ratings for the generated results of different models. The experts assessed the generated images based on five criteria: visual appeal, text faithfulness, face similarity, facial aesthetics and overall satisfaction. Visual appeal and text faithfulness are used to measure the text-to-image generation capability, adhering to the evaluation standards of BaseModel. Meanwhile, face similarity and facial aesthetics are used to evaluate the performance of the proposed Kolors-IP-Adapter-FaceID-Plus. The results are summarized in the table below, where Kolors-IP-Adapter-FaceID-Plus outperforms SDXL-IP-Adapter-FaceID-Plus across all metrics.


|       Model       |  Average Text Faithfulness | Average Visual Appeal | Average Face Similarity | Average Facial Aesthetics | Average Overall Satisfaction |
| :--------------: | :--------: | :--------: | :--------: | :--------: | :--------: |
| SDXL-IP-Adapter-FaceID-Plus |	4.014	| 3.455	| 3.05	| 2.584	| 2.448 |
| **Kolors-IP-Adapter-FaceID-Plus** | **4.235** |  **4.374**  | **4.415** | **3.887** | **3.561** |
------

<br>


<table>
  <tr>
    <td colspan="4" align="center"> Comparison Results </td>
  </tr>
  
  <tr>
    <td align="center">Reference Image </td>
    <td align="center">Prompt </td>
    <td align="center">SDXL-IP-Adapter-FaceID-Plus </td>
    <td align="center">Kolors-IP-Adapter-FaceID-Plus </td>
  </tr>

  <tr>
    <td align="center"><img src="./assets/test_img1_org.png" width=400px/></td>
    <td align="center"><font style="font-size:10px">å¤å…¸æ²¹ç”»é£æ ¼ï¼Œæ²¹å½©åšé‡, å¤å…¸ç¾æ„Ÿï¼Œå†å²æ°”æ¯ </p> Classical oil painting style, thick oil paint, classical aesthetic, historical atmosphere. </font> </td>
    <td align="center"><img src="./assets/test_img1_SDXL.png" width=400px/> </td>
    <td align="center"><img src="./assets/test_img1_Kolors.png" width=400px/> </td>
  </tr>

  <tr>
    <td align="center"><img src="./assets/test_img2_org.png" width=400px/></td>
    <td align="center"><font style="font-size:10px">å¤œæ™šï¼Œæµªæ¼«çš„æµ·è¾¹ï¼Œè½æ—¥ä½™æ™–æ´’åœ¨æµ·é¢ä¸Šï¼Œæ™šéœæ˜ ç…§ç€æ•´ä¸ªæµ·æ»©ï¼Œå¤´æˆ´èŠ±ç¯ï¼ŒèŠ±çŸ­è¢–ï¼Œé£˜é€¸çš„å¤´å‘ï¼ŒèƒŒæ™¯æ˜¯ç¾ä¸½çš„æµ·æ»©ï¼Œå¯çˆ±å¹´è½»çš„åŠèº«ç…§ï¼Œä¼˜é›…æ¢¦å¹»ï¼Œç»†èŠ‚ç¹å¤ï¼Œè¶…é€¼çœŸï¼Œé«˜åˆ†è¾¨ç‡ï¼ŒæŸ”å’Œçš„èƒŒæ™¯ï¼Œä½å¯¹æ¯”åº¦ </p> Night, romantic seaside, sunset glow on the sea, evening glow reflecting on the whole beach, wearing a flower crown, short floral sleeves, flowing hair, background is a beautiful beach, cute young half-body portrait, elegant and dreamy, intricate details, ultra-realistic, high resolution, soft background, low contrast.</font> </td>
    <td align="center"><img src="./assets/test_img2_SDXL.png" width=400px/> </td>
    <td align="center"><img src="./assets/test_img2_Kolors.png" width=400px/> </td>
  </tr>

  <tr>
    <td align="center"><img src="./assets/test_img3_org.png" width=400px/></td>
    <td align="center"><font style="font-size:10px">F1èµ›è½¦æ‰‹, æ³•æ‹‰åˆ©ï¼Œæˆ´ç€ç€çº¢é»‘ç™½ç›¸é—´çš„èµ›è½¦æ‰‹å¤´ç›”ï¼Œå¸…æ°”çš„èµ›è½¦æ‰‹ï¼Œé£èˆçš„å½©å¸¦ï¼ŒèƒŒæ™¯èµ›è½¦è½¦åº“å’Œå¤©èŠ±æ¿æ³›å…‰ï¼Œç’€ç’¨é—ªå…‰ï¼Œç©¿çº¢ç™½é»‘ç›¸é—´èµ›è½¦æœï¼Œè‰²è°ƒç»Ÿä¸€ä¸”æ˜è‰³ï¼Œé¢éƒ¨ç™½çš™ï¼Œé¢éƒ¨ç‰¹å†™ï¼Œæ­£è§†å›¾ </p>F1 racer, Ferrari, wearing a red, black, and white racing helmet, handsome racer, flying ribbons, background race car garage and ceiling lights, dazzling flashes, wearing red, white, and black racing suit, unified and bright color tone, fair face, facial close-up, front view.</font> </td>
    <td align="center"><img src="./assets/test_img3_SDXL.png" width=400px/> </td>
    <td align="center"><img src="./assets/test_img3_Kolors.png" width=400px/> </td>
  </tr>

  <tr>
    <td align="center"><img src="./assets/test_img4_org.png" width=400px/></td>
    <td align="center"><font style="font-size:10px">å’Œæœï¼Œæ—¥æœ¬ä¼ ç»Ÿæœé¥°ï¼Œåœ¨æµ·è¾¹çš„é»„æ˜ï¼Œè¿œå±±çš„èƒŒæ™¯ï¼Œåœ¨è¿œå¤„çš„çƒŸç«ï¼ŒæŸ”å’Œçš„ç¯å…‰ï¼Œé•¿ç„¦é•œå¤´ï¼Œå¤œé—´æ‘„å½±é£æ ¼ï¼Œå‡‰çˆ½çš„è‰²è°ƒï¼Œæµªæ¼«çš„æ°”æ°›ï¼Œç«èŠ±å››æº…ï¼Œæ—¶å°šæ‘„å½±ï¼Œèƒ¶ç‰‡æ»¤é•œ </p> Kimono, traditional Japanese clothing, at the seaside at dusk, distant mountain background, fireworks in the distance, soft lighting, telephoto lens, night photography style, cool tones, romantic atmosphere, sparks flying, fashion photography, film filter.</font> </td>
    <td align="center"><img src="./assets/test_img4_SDXL.png" width=400px/> </td>
    <td align="center"><img src="./assets/test_img4_Kolors.png" width=400px/> </td>
  </tr>
  
</table>

<font color=gray style="font-size:12px"> *Kolors-IP-Adapter-FaceID-Plus employs chinese prompts, while SDXL-IP-Adapter-FaceID-Plus uses english prompts.*</font>

## <a name="Usage"></a>ğŸ› ï¸ Usage

### Requirements

The dependencies and installation are basically the same as the [Kolors-BaseModel](https://huggingface.co/Kwai-Kolors/Kolors).

<br>

1. Repository Cloning and Dependency Installation

```bash
apt-get install git-lfs
git clone https://github.com/Kwai-Kolors/Kolors
cd Kolors
conda create --name kolors python=3.8
conda activate kolors
pip install -r requirements.txt
pip install insightface onnxruntime-gpu
python3 setup.py install
```

2. Weights download [link](https://huggingface.co/Kwai-Kolors/Kolors-IP-Adapter-FaceID-Plus)ï¼š
```bash
huggingface-cli download --resume-download Kwai-Kolors/Kolors-IP-Adapter-FaceID-Plus --local-dir weights/Kolors-IP-Adapter-FaceID-Plus
```
or
```bash
git lfs clone https://huggingface.co/Kwai-Kolors/Kolors-IP-Adapter-FaceID-Plus weights/Kolors-IP-Adapter-FaceID-Plus
```

3. Inferenceï¼š
```bash
python ipadapter_FaceID/sample_ipadapter_faceid_plus.py ./ipadapter_FaceID/assets/image1.png "ç©¿ç€æ™šç¤¼æœï¼Œåœ¨æ˜Ÿå…‰ä¸‹çš„æ™šå®´åœºæ™¯ä¸­ï¼Œçƒ›å…‰é—ªé—ªï¼Œæ•´ä¸ªåœºæ™¯æ´‹æº¢ç€æµªæ¼«è€Œå¥¢åçš„æ°›å›´"

python ipadapter_FaceID/sample_ipadapter_faceid_plus.py ./ipadapter_FaceID/assets/image2.png "è¥¿éƒ¨ç‰›ä»”ï¼Œç‰›ä»”å¸½ï¼Œè’é‡å¤§é•–å®¢ï¼ŒèƒŒæ™¯æ˜¯è¥¿éƒ¨å°é•‡ï¼Œä»™äººæŒï¼Œ,æ—¥è½ä½™æ™–, æš–è‰²è°ƒ, ä½¿ç”¨XT4èƒ¶ç‰‡æ‹æ‘„, å™ªç‚¹, æ™•å½±, æŸ¯è¾¾èƒ¶å·ï¼Œå¤å¤"

# The image will be saved to "scripts/outputs/"
```

### Acknowledgments
- Thanks to [insightface](https://github.com/deepinsight/insightface) for the face representations.
- Thanks to [IP-Adapter](https://github.com/tencent-ailab/IP-Adapter) for the codebase.
<br>

